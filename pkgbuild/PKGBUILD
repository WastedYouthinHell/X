pkgname=slskd
pkgver=0.16.20
pkgrel=1
arch=("x86_64")
url="https://github.com/slskd/slskd"
license=("GPL3")
options=("strip")
depends=("dotnet-runtime")
makedepends=("npm" "dotnet-sdk")
source=("$url/archive/$pkgver.tar.gz")
sha256sums=("195079914dc05b0bad322819133183cf455ab5a8c60e51942d0e8038bfe8184a")

build() {
  cd "$pkgname-$pkgver"
  bin/build --version $pkgver
}

package() {
  cd "$pkgname-$pkgver"/src/slskd
  dotnet publish \
    --configuration Release \
    -p:ReadyToRun=true \
    -p:CopyOutputSymbolsToPublishDirectory=false \
    -p:Version=$pkgver \
    --output $pkgdir/opt/slskd/

  cd ../..
  mkdir -p $pkgdir/usr/bin
  mkdir -p $pkgdir/var/lib/slskd
  chmod 777 $pkgdir/var/lib/slskd
  ln -s /opt/slskd/slskd $pkgdir/usr/bin/slskd
  install -Dm644 ../../slskd.service $pkgdir/usr/lib/systemd/system/slskd.service
  install -Dm644 ../../slskd.conf $pkgdir/usr/lib/sysusers.d/slskd.conf
}
